#!/bin/sh
. "$HOME/.scripts/variables"

exist() {
    command -v "$1" >/dev/null 2>&1
}

wallpapers_folder="$HOME/.config/wallpapers/"
theme="${wallpapers_folder}$(
    find "$wallpapers_folder" -printf '%P\n' |
        grep --invert-match "^$" | $DMENU --placeholder="Select a theme..."

)"

if [ "$theme" != "$wallpapers_folder" ]; then
    swww img "$theme" &&
        exist wal && wal --cols16 lighten -nqei "$theme"
    # color reload
    # waybar
    cp ~/.cache/wal/colors-waybar.css ~/.config/waybar/colors.css
    # sway nc
    cp ~/.cache/wal/colors.css ~/.config/swaync/colors.css
    swaync-client --reload-css
    # ghostty
    if [ -d ~/.config/ghostty/themes ]; then mkdir ~/.config/ghostty/themes; fi; 
    cp ~/.cache/wal/ghostty.conf ~/.config/ghostty/themes/wal
    # river
    awk 'NR==2 {print $1}' ~/.cache/wal/colors | sed 's/#/0x/' > ~/.config/river/colors
    cat "$HOME"/.config/river/colors | xargs riverctl border-color-focused 
fi
